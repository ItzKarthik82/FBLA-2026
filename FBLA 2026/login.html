<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PeerLearn - Login & Sign Up</title>
    <link rel="stylesheet" href="styles.css">
    <script src="script.js"></script>
    <style>
        .login-page {
            min-height: calc(100vh - 60px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            background: var(--bg);
        }

        .auth-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            max-width: 1000px;
            width: 100%;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            background: var(--white);
            animation: cardIn 0.4s ease;
        }

        body.dark .auth-container {
            background: var(--card-bg);
        }

        @keyframes cardIn {
            from {
                opacity: 0;
                transform: translateY(12px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-left {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            color: white;
        }

        .auth-left h1 {
            font-size: 40px;
            font-weight: 800;
            margin-bottom: 20px;
        }

        .auth-left p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 32px;
            opacity: 0.95;
        }

        .features-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .features-list li {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .features-list li::before {
            content: 'âœ“';
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 50%;
            margin-right: 12px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .auth-right {
            padding: 60px 50px;
            background: var(--white);
        }

        body.dark .auth-right {
            background: var(--card-bg);
        }

        .auth-header h2 {
            font-size: 28px;
            font-weight: 700;
            margin: 0 0 8px 0;
            color: var(--gray-900);
        }

        body.dark .auth-header h2 {
            color: var(--text);
        }

        .auth-header p {
            color: var(--gray-500);
            font-size: 14px;
            margin: 0 0 30px 0;
        }

        body.dark .auth-header p {
            color: var(--text-muted);
        }

        .tabs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-bottom: 30px;
            background: var(--gray-50);
            padding: 6px;
            border-radius: var(--border-radius);
        }

        .tab-button {
            padding: 12px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: var(--border-radius);
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        body.dark .tab-button {
            color: var(--text-muted);
        }

        .tab-button:hover {
            color: var(--primary);
        }

        .tab-button.active {
            background: var(--white);
            color: var(--primary);
            border-color: var(--gray-200);
            box-shadow: var(--shadow-sm);
            transform: translateY(-1px);
        }

        body.dark .tabs {
            background: var(--bg);
        }

        body.dark .tab-button.active {
            background: var(--card-bg);
            border-color: var(--border);
        }

        .form-container {
            display: none;
            min-height: 480px;
        }

        .form-container.active {
            display: block;
        }

        .form-input-group {
            margin-bottom: 20px;
        }

        .form-input-group label {
            display: block;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
            font-size: 14px;
        }

        body.dark .form-input-group label {
            color: var(--text);
        }

        .form-input-group input,
        .form-input-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius);
            font-size: 14px;
            background: var(--white);
            color: var(--gray-900);
            transition: all 0.2s ease;
            font-family: inherit;
        }

        body.dark .form-input-group input,
        body.dark .form-input-group select {
            background: var(--bg);
            border-color: var(--border);
            color: var(--text);
        }

        .form-input-group input:focus,
        .form-input-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-input-group input.input-valid,
        .form-input-group select.input-valid {
            border-color: var(--secondary);
        }

        .form-input-group input.input-error,
        .form-input-group select.input-error {
            border-color: var(--danger);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.12);
        }

        .error-text {
            color: var(--danger);
            font-size: 12px;
            margin-top: 8px;
            display: none;
            background: rgba(239, 68, 68, 0.08);
            border: 1px solid rgba(239, 68, 68, 0.25);
            border-left: 3px solid var(--danger);
            padding: 8px 10px;
            border-radius: 8px;
            line-height: 1.4;
        }

        .error-text::before {
            content: 'âš ';
            margin-right: 6px;
            font-size: 12px;
        }

        .submit-button {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 20px;
        }

        .submit-button:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .form-link {
            text-align: center;
            font-size: 13px;
            color: var(--gray-600);
            margin-top: 16px;
        }

        body.dark .form-link {
            color: var(--text-muted);
        }

        .form-link a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .form-link a:hover {
            text-decoration: underline;
        }

        .reset-panel {
            display: block;
        }

        body.dark .reset-panel {
            border-top-color: var(--border);
        }

        .reset-panel.show {
            display: block;
        }

        .reset-header h3 {
            font-size: 16px;
            margin: 0 0 4px 0;
            color: var(--gray-900);
        }

        body.dark .reset-header h3 {
            color: var(--text);
        }

        .reset-header p {
            font-size: 12px;
            color: var(--gray-500);
            margin: 0 0 12px 0;
        }

        body.dark .reset-header p {
            color: var(--text-muted);
        }

        .reset-step {
            display: none;
        }

        .reset-step.active {
            display: block;
        }

        .reset-question {
            font-size: 13px;
            color: var(--gray-700);
            margin: 6px 0 10px 0;
            padding: 10px 12px;
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
        }

        body.dark .reset-question {
            color: var(--text);
            background: var(--bg);
            border-color: var(--border);
        }

        .reset-actions {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

        .reset-button {
            flex: 1;
            padding: 10px 12px;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .reset-button.primary {
            background: var(--primary);
            color: white;
        }

        .reset-button.secondary {
            background: transparent;
            color: var(--gray-700);
            border: 1px solid var(--gray-200);
        }

        body.dark .reset-button.secondary {
            color: var(--text);
            border-color: var(--border);
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 2000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-card {
            width: 100%;
            max-width: 520px;
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            padding: 24px 24px 20px 24px;
            position: relative;
            animation: cardIn 0.25s ease;
        }

        body.dark .modal-card {
            background: var(--card-bg);
        }

        .modal-close {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--gray-100);
            color: var(--gray-600);
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.dark .modal-close {
            background: var(--bg);
            color: var(--text-muted);
        }

        .requirement-msg {
            color: var(--secondary);
            font-size: 12px;
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
        }

        .requirement-msg::before {
            content: 'âœ“';
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            background: var(--secondary);
            border-radius: 50%;
            color: white;
            font-size: 9px;
            font-weight: bold;
        }

        .requirements-list {
            margin-top: 10px;
            padding: 0;
            border: none;
            background: transparent;
            max-height: none;
            opacity: 1;
            overflow: visible;
            transform: none;
            transition: none;
            display: none;
        }

        body.dark .requirements-list {
            background: transparent;
            border-color: transparent;
        }

        .requirements-list.show {
            display: block;
        }

        .req-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            margin-bottom: 6px;
            color: var(--danger);
            padding: 0;
            border: none;
            background: transparent;
            transition: none;
            position: static;
        }

        body.dark .req-item {
            color: #fca5a5;
            background: transparent;
            border-color: transparent;
        }

        .req-item:last-child {
            margin-bottom: 0;
        }

        .req-item.met {
            color: var(--secondary);
        }

        .req-item.unmet {
            color: var(--danger);
        }

        .req-check {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 1px solid var(--danger);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 10px;
            font-weight: 700;
            color: var(--danger);
            background: rgba(239, 68, 68, 0.12);
            transition: none;
        }

        body.dark .req-check {
            border-color: rgba(239, 68, 68, 0.5);
        }

        .req-check.met {
            background: transparent;
            border-color: transparent;
            color: transparent;
        }

        .req-check.unmet {
            border-color: var(--danger);
        }

        .notification-popup {
            position: fixed;
            padding: 14px 20px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 500;
            z-index: 1000;
            font-size: 14px;
            animation: popIn 0.3s ease;
        }

        .notification-popup.success {
            background: var(--secondary);
            bottom: 24px;
            left: 24px;
        }

        .notification-popup.error {
            background: var(--danger);
            top: 24px;
            right: 24px;
        }

        @keyframes popIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 900px) {
            .auth-container {
                grid-template-columns: 1fr;
            }
            .auth-left {
                display: none;
            }
            .auth-right {
                padding: 40px 30px;
            }
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <h1 class="brand">PeerLearn</h1>
            <p class="tag">Academic Learning Hub</p>
            <nav>
                <ul class="nav">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="schedule.html">Schedule</a></li>
                    <li><a href="resources.html">Resources</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <div class="auth-menu">
                    <button id="authMenuBtn" class="auth-trigger" aria-haspopup="true" aria-expanded="false">ðŸ‘¤</button>
                    <div class="auth-dropdown" id="authDropdown">
                        <div class="auth-dropdown-header" id="authDropdownHeader">Not signed in</div>
                        <button class="auth-item" data-action="login">Log In</button>
                        <button class="auth-item" data-action="signup">Sign Up</button>
                    </div>
                </div>
                <button id="themeToggle" class="btn outline">ðŸŒ™ Dark</button>
            </div>
        </div>
    </header>

    <main class="content">
        <div class="login-page">
            <div class="auth-container">
                <div class="auth-left">
                    <h1>PeerLearn</h1>
                    <p>Join thousands of students achieving their academic goals through collaborative learning and expert guidance.</p>
                    <ul class="features-list">
                        <li>Track your study progress</li>
                        <li>Access learning materials</li>
                        <li>Manage your schedule</li>
                        <li>Connect with peers</li>
                    </ul>
                </div>

                <div class="auth-right">
                    <div class="auth-header">
                        <h2>Welcome</h2>
                        <p>Sign in to your account</p>
                    </div>

                    <div class="tabs">
                        <button class="tab-button active" data-form="login">Login</button>
                        <button class="tab-button" data-form="signup">Sign Up</button>
                    </div>

                    <!-- LOGIN FORM -->
                    <form id="login" class="form-container active">
                        <div class="form-input-group">
                            <label>Email Address</label>
                            <input type="email" id="loginEmail" placeholder="you@example.com">
                            <div class="error-text" id="loginEmailErr"></div>
                            <div class="requirements-list" id="loginEmailReqs">
                                <div class="req-item">
                                    <div class="req-check" id="loginEmailCheck"></div>
                                    <span>Enter a valid email address</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-input-group">
                            <label>Password</label>
                            <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                            <div class="error-text" id="loginPassErr"></div>
                            <div class="requirements-list" id="loginPassReqs">
                                <div class="req-item">
                                    <div class="req-check" id="loginPassCheck"></div>
                                    <span>Enter your password</span>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="submit-button">Sign In</button>
                        <div class="form-link">
                            <a href="#" id="forgotLink">Forgot password?</a>
                        </div>
                    </form>

                    <!-- SIGNUP FORM -->
                    <form id="signup" class="form-container">
                        <div class="form-input-group">
                            <label>Full Name</label>
                            <input type="text" id="regName" placeholder="John Doe">
                            <div class="error-text" id="regNameErr"></div>
                            <div class="requirements-list" id="regNameReqs">
                                <div class="req-item">
                                    <div class="req-check" id="regNameCheck"></div>
                                    <span>Enter your full name</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-input-group">
                            <label>Email Address</label>
                            <input type="email" id="regEmail" placeholder="you@example.com">
                            <div class="error-text" id="regEmailErr"></div>
                            <div class="requirements-list" id="regEmailReqs">
                                <div class="req-item">
                                    <div class="req-check" id="regEmailCheck"></div>
                                    <span>Enter a valid email address</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-input-group">
                            <label>Password</label>
                            <input type="password" id="regPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                            <div class="error-text" id="regPassErr"></div>
                            <div class="requirements-list" id="regPassReqs">
                                <div class="req-item">
                                    <div class="req-check" id="regPassCheck"></div>
                                    <span>Password must be at least 6 characters</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-input-group">
                            <label>Confirm Password</label>
                            <input type="password" id="regPassConfirm" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                            <div class="error-text" id="regPassConfirmErr"></div>
                            <div class="requirements-list" id="regPassConfirmReqs">
                                <div class="req-item">
                                    <div class="req-check" id="regPassConfirmCheck"></div>
                                    <span>Passwords must match</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-input-group">
                            <label>Security Question</label>
                            <select id="regQuestion">
                                <option value="">Choose a question...</option>
                                <option value="pet">What was your first pet's name?</option>
                                <option value="city">What city were you born in?</option>
                                <option value="school">What was your elementary school?</option>
                                <option value="teacher">Favorite teacher's name?</option>
                                <option value="color">What is your favorite color?</option>
                            </select>
                            <div class="error-text" id="regQuestionErr"></div>
                            <div class="requirements-list" id="regQuestionReqs">
                                <div class="req-item">
                                    <div class="req-check" id="regQuestionCheck"></div>
                                    <span>Select a security question</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-input-group">
                            <label>Your Answer</label>
                            <input type="text" id="regAnswer" placeholder="Your answer">
                            <div class="error-text" id="regAnswerErr"></div>
                            <div class="requirements-list" id="regAnswerReqs">
                                <div class="req-item">
                                    <div class="req-check" id="regAnswerCheck"></div>
                                    <span>Provide your answer</span>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="submit-button">Create Account</button>
                        <div class="form-link">
                            By signing up, you agree to our <a href="#">Terms of Service</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>PeerLearn</h4>
                    <p>Student-built, student-powered learning platform.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="schedule.html">Schedule</a></li>
                        <li><a href="resources.html">Resources</a></li>
                        <li><a href="dashboard.html">Dashboard</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Connect</h4>
                    <p>Built for FBLA 2026</p>
                    <p>Created by students, for students</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 PeerLearn. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div class="modal-overlay" id="resetModal" aria-hidden="true">
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="resetTitle">
            <button class="modal-close" id="resetClose" aria-label="Close">Ã—</button>
            <div class="reset-panel" id="resetPanel">
                <div class="reset-header">
                    <h3 id="resetTitle">Reset Password</h3>
                    <p>Verify with your security question to set a new password.</p>
                </div>

                <form id="resetStepEmail" class="reset-step active">
                    <div class="form-input-group">
                        <label>Email Address</label>
                        <input type="email" id="resetEmail" placeholder="you@example.com">
                        <div class="error-text" id="resetEmailErr"></div>
                    </div>
                    <button type="submit" class="reset-button primary">Continue</button>
                </form>

                <form id="resetStepVerify" class="reset-step">
                    <div class="reset-question" id="resetQuestionText"></div>

                    <div class="form-input-group">
                        <label>Answer</label>
                        <input type="text" id="resetAnswer" placeholder="Your answer">
                        <div class="error-text" id="resetAnswerErr"></div>
                    </div>

                    <div class="form-input-group">
                        <label>New Password</label>
                        <input type="password" id="resetNewPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                        <div class="error-text" id="resetNewPassErr"></div>
                    </div>

                    <div class="form-input-group">
                        <label>Confirm New Password</label>
                        <input type="password" id="resetConfirmPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                        <div class="error-text" id="resetConfirmPassErr"></div>
                    </div>

                    <div class="reset-actions">
                        <button type="button" class="reset-button secondary" id="resetBack">Back</button>
                        <button type="submit" class="reset-button primary">Reset Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Redirect if already logged in
        if (typeof checkAuth !== 'undefined' && checkAuth()) {
            window.location.href = 'dashboard.html';
        }

        // Notification helper
        function showNotif(msg, type) {
            const notif = document.createElement('div');
            notif.className = `notification-popup ${type}`;
            notif.textContent = msg;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3500);
        }

        // Email regex
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        const focusState = {};

        function setInputState(inputId, state) {
            const input = document.getElementById(inputId);
            if (!input) return;
            input.classList.remove('input-valid', 'input-error');
            if (state === 'valid') input.classList.add('input-valid');
            if (state === 'error') input.classList.add('input-error');
        }

        // Clear errors on input
        document.querySelectorAll('input, select').forEach(field => {
            field.addEventListener('input', () => {
                const errorId = field.id + 'Err';
                const errorEl = document.getElementById(errorId);
                if (errorEl) {
                    errorEl.style.display = 'none';
                }
                field.classList.remove('input-error');
            });
        });

        // Update login requirements
        function updateLoginReqs() {
            const email = document.getElementById('loginEmail').value.trim();
            const pass = document.getElementById('loginPass').value;

            const emailValid = isValidEmail(email);
            const passValid = pass.length > 0;

            updateReqDisplay('loginEmailReqs', 'loginEmailCheck', emailValid, focusState.loginEmail || email.length > 0);
            updateReqDisplay('loginPassReqs', 'loginPassCheck', passValid, focusState.loginPass || pass.length > 0);

            setInputState('loginEmail', email.length === 0 ? '' : (emailValid ? 'valid' : 'error'));
            setInputState('loginPass', pass.length === 0 ? '' : 'valid');
        }

        // Update signup requirements
        function updateSignupReqs() {
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const pass = document.getElementById('regPass').value;
            const confirm = document.getElementById('regPassConfirm').value;
            const question = document.getElementById('regQuestion').value;
            const answer = document.getElementById('regAnswer').value.trim();

            const nameValid = name.length > 0;
            const emailValid = isValidEmail(email);
            const passValid = pass.length >= 6;
            const matchValid = pass === confirm && pass.length > 0;
            const questionValid = question.length > 0;
            const answerValid = answer.length > 0;

            updateReqDisplay('regNameReqs', 'regNameCheck', nameValid, focusState.regName || name.length > 0);
            updateReqDisplay('regEmailReqs', 'regEmailCheck', emailValid, focusState.regEmail || email.length > 0);
            updateReqDisplay('regPassReqs', 'regPassCheck', passValid, focusState.regPass || pass.length > 0);
            updateReqDisplay('regPassConfirmReqs', 'regPassConfirmCheck', matchValid, focusState.regPassConfirm || confirm.length > 0);
            updateReqDisplay('regQuestionReqs', 'regQuestionCheck', questionValid, focusState.regQuestion || question.length > 0);
            updateReqDisplay('regAnswerReqs', 'regAnswerCheck', answerValid, focusState.regAnswer || answer.length > 0);

            setInputState('regName', name.length === 0 ? '' : (nameValid ? 'valid' : 'error'));
            setInputState('regEmail', email.length === 0 ? '' : (emailValid ? 'valid' : 'error'));
            setInputState('regPass', pass.length === 0 ? '' : (passValid ? 'valid' : 'error'));
            setInputState('regPassConfirm', confirm.length === 0 ? '' : (matchValid ? 'valid' : 'error'));
            setInputState('regQuestion', question.length === 0 ? '' : (questionValid ? 'valid' : 'error'));
            setInputState('regAnswer', answer.length === 0 ? '' : (answerValid ? 'valid' : 'error'));
        }

        // Helper to update requirement display
        function updateReqDisplay(containerId, checkId, isMet, show) {
            const container = document.getElementById(containerId);
            const check = document.getElementById(checkId);
            const item = check ? check.parentElement : null;

            const shouldShow = show && !isMet;

            if (shouldShow) {
                container.classList.add('show');
                check.classList.remove('met');
                check.classList.add('unmet');
                check.textContent = '!';
                if (item) {
                    item.classList.remove('met');
                    item.classList.add('unmet');
                }
            } else {
                container.classList.remove('show');
                check.classList.remove('unmet');
                if (item) item.classList.remove('unmet');
                if (isMet) {
                    check.classList.add('met');
                    check.textContent = 'âœ“';
                    if (item) item.classList.add('met');
                } else {
                    check.classList.remove('met');
                    check.textContent = '';
                    if (item) item.classList.remove('met');
                }
            }
        }

        function updateAllReqs() {
            updateLoginReqs();
            updateSignupReqs();
        }

        // Focus and input listeners
        const trackedFields = [
            'loginEmail', 'loginPass',
            'regName', 'regEmail', 'regPass', 'regPassConfirm', 'regQuestion', 'regAnswer'
        ];

        trackedFields.forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            el.addEventListener('focus', () => {
                focusState[id] = true;
                updateAllReqs();
            });
            el.addEventListener('blur', () => {
                focusState[id] = false;
                updateAllReqs();
            });
            el.addEventListener('input', updateAllReqs);
            if (el.tagName === 'SELECT') {
                el.addEventListener('change', updateAllReqs);
            }
        });

        // Tab switching
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.addEventListener('click', () => {
                const formId = btn.getAttribute('data-form');
                
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
                
                btn.classList.add('active');
                document.getElementById(formId).classList.add('active');
                
                // Clear all errors
                document.querySelectorAll('.error-text').forEach(e => e.style.display = 'none');
                document.querySelectorAll('input, select').forEach(field => field.classList.remove('input-error'));
                updateAllReqs();
            });
        });

        // Open signup tab if URL hash is #signup
        if (window.location.hash === '#signup') {
            const signupBtn = document.querySelector('.tab-button[data-form="signup"]');
            if (signupBtn) signupBtn.click();
        }

        // Reset password flow
        const forgotLink = document.getElementById('forgotLink');
        const resetModal = document.getElementById('resetModal');
        const resetClose = document.getElementById('resetClose');
        const resetPanel = document.getElementById('resetPanel');
        const resetStepEmail = document.getElementById('resetStepEmail');
        const resetStepVerify = document.getElementById('resetStepVerify');
        const resetQuestionText = document.getElementById('resetQuestionText');
        const resetBack = document.getElementById('resetBack');

        const questionMap = {
            pet: "What was your first pet's name?",
            city: "What city were you born in?",
            school: "What was your elementary school?",
            teacher: "Favorite teacher's name?",
            color: "What is your favorite color?"
        };

        let resetUserIndex = null;

        function showResetPanel() {
            resetModal.classList.add('show');
            resetModal.setAttribute('aria-hidden', 'false');
            resetStepEmail.classList.add('active');
            resetStepVerify.classList.remove('active');
            resetUserIndex = null;
            document.getElementById('resetEmail').value = '';
            document.getElementById('resetAnswer').value = '';
            document.getElementById('resetNewPass').value = '';
            document.getElementById('resetConfirmPass').value = '';
            document.querySelectorAll('#resetPanel .error-text').forEach(e => e.style.display = 'none');
            document.body.style.overflow = 'hidden';
        }

        function hideResetPanel() {
            resetModal.classList.remove('show');
            resetModal.setAttribute('aria-hidden', 'true');
            resetStepEmail.classList.add('active');
            resetStepVerify.classList.remove('active');
            resetUserIndex = null;
            document.body.style.overflow = '';
        }

        if (forgotLink) {
            forgotLink.addEventListener('click', (e) => {
                e.preventDefault();
                showResetPanel();
            });
        }

        resetClose.addEventListener('click', hideResetPanel);

        resetModal.addEventListener('click', (e) => {
            if (e.target === resetModal) hideResetPanel();
        });

        resetBack.addEventListener('click', () => {
            hideResetPanel();
        });

        resetStepEmail.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('resetEmail').value.trim();
            const emailErr = document.getElementById('resetEmailErr');
            emailErr.style.display = 'none';

            if (!email || !isValidEmail(email)) {
                emailErr.textContent = email ? 'Enter a valid email address' : 'Email is required';
                emailErr.style.display = 'block';
                return;
            }

            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const index = users.findIndex(u => u.email.toLowerCase() === email.toLowerCase());

            if (index === -1) {
                emailErr.textContent = 'No account found with that email';
                emailErr.style.display = 'block';
                return;
            }

            resetUserIndex = index;
            const questionKey = users[index].securityQuestion;
            resetQuestionText.textContent = questionMap[questionKey] || 'Security question';

            resetStepEmail.classList.remove('active');
            resetStepVerify.classList.add('active');
        });

        resetStepVerify.addEventListener('submit', (e) => {
            e.preventDefault();

            const answer = document.getElementById('resetAnswer').value.trim();
            const newPass = document.getElementById('resetNewPass').value;
            const confirmPass = document.getElementById('resetConfirmPass').value;

            const answerErr = document.getElementById('resetAnswerErr');
            const newPassErr = document.getElementById('resetNewPassErr');
            const confirmErr = document.getElementById('resetConfirmPassErr');

            answerErr.style.display = 'none';
            newPassErr.style.display = 'none';
            confirmErr.style.display = 'none';

            let valid = true;

            if (!answer) {
                answerErr.textContent = 'Answer is required';
                answerErr.style.display = 'block';
                valid = false;
            }

            if (!newPass || newPass.length < 6) {
                newPassErr.textContent = newPass ? 'Password must be at least 6 characters' : 'New password is required';
                newPassErr.style.display = 'block';
                valid = false;
            }

            if (!confirmPass || confirmPass !== newPass) {
                confirmErr.textContent = confirmPass ? 'Passwords must match' : 'Confirm your new password';
                confirmErr.style.display = 'block';
                valid = false;
            }

            if (!valid) return;

            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const user = users[resetUserIndex];

            if (!user || user.securityAnswer?.toLowerCase() !== answer.toLowerCase()) {
                answerErr.textContent = 'Incorrect answer';
                answerErr.style.display = 'block';
                return;
            }

            users[resetUserIndex].password = newPass;
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            showNotif('Password reset successful. Please sign in.', 'success');
            hideResetPanel();
        });

        // LOGIN FORM
        document.getElementById('login').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value.trim();
            const pass = document.getElementById('loginPass').value;
            
            const emailErr = document.getElementById('loginEmailErr');
            const passErr = document.getElementById('loginPassErr');
            
            emailErr.style.display = 'none';
            passErr.style.display = 'none';
            
            let valid = true;
            
            if (!email) {
                emailErr.textContent = 'Email is required';
                emailErr.style.display = 'block';
                setInputState('loginEmail', 'error');
                valid = false;
            } else if (!isValidEmail(email)) {
                emailErr.textContent = 'Invalid email format';
                emailErr.style.display = 'block';
                setInputState('loginEmail', 'error');
                valid = false;
            }
            
            if (!pass) {
                passErr.textContent = 'Password is required';
                passErr.style.display = 'block';
                setInputState('loginPass', 'error');
                valid = false;
            }
            
            if (!valid) return;
            
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const user = users.find(u => u.email.toLowerCase() === email.toLowerCase() && u.password === pass);
            
            if (user) {
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('userName', user.name);
                localStorage.setItem('userEmail', user.email);
                showNotif('Login successful!', 'success');
                setTimeout(() => window.location.href = 'dashboard.html', 1500);
            } else {
                showNotif('Invalid email or password', 'error');
            }
        });

        // SIGNUP FORM
        document.getElementById('signup').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const pass = document.getElementById('regPass').value;
            const passConfirm = document.getElementById('regPassConfirm').value;
            const question = document.getElementById('regQuestion').value;
            const answer = document.getElementById('regAnswer').value.trim();
            
            // Clear errors
            document.querySelectorAll('.error-text').forEach(e => e.style.display = 'none');
            
            let valid = true;
            
            if (!name) {
                document.getElementById('regNameErr').textContent = 'Name is required';
                document.getElementById('regNameErr').style.display = 'block';
                setInputState('regName', 'error');
                valid = false;
            }
            
            if (!email) {
                document.getElementById('regEmailErr').textContent = 'Email is required';
                document.getElementById('regEmailErr').style.display = 'block';
                setInputState('regEmail', 'error');
                valid = false;
            } else if (!isValidEmail(email)) {
                document.getElementById('regEmailErr').textContent = 'Invalid email format';
                document.getElementById('regEmailErr').style.display = 'block';
                setInputState('regEmail', 'error');
                valid = false;
            }
            
            if (!pass) {
                document.getElementById('regPassErr').textContent = 'Password is required';
                document.getElementById('regPassErr').style.display = 'block';
                setInputState('regPass', 'error');
                valid = false;
            } else if (pass.length < 6) {
                document.getElementById('regPassErr').textContent = 'Password must be 6+ characters';
                document.getElementById('regPassErr').style.display = 'block';
                setInputState('regPass', 'error');
                valid = false;
            }
            
            if (!passConfirm) {
                document.getElementById('regPassConfirmErr').textContent = 'Confirm your password';
                document.getElementById('regPassConfirmErr').style.display = 'block';
                setInputState('regPassConfirm', 'error');
                valid = false;
            } else if (pass !== passConfirm) {
                document.getElementById('regPassConfirmErr').textContent = 'Passwords do not match';
                document.getElementById('regPassConfirmErr').style.display = 'block';
                setInputState('regPassConfirm', 'error');
                valid = false;
            }
            
            if (!question) {
                document.getElementById('regQuestionErr').textContent = 'Select a question';
                document.getElementById('regQuestionErr').style.display = 'block';
                setInputState('regQuestion', 'error');
                valid = false;
            }
            
            if (!answer) {
                document.getElementById('regAnswerErr').textContent = 'Answer is required';
                document.getElementById('regAnswerErr').style.display = 'block';
                setInputState('regAnswer', 'error');
                valid = false;
            }
            
            if (!valid) return;
            
            // Check if email exists
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            if (users.some(u => u.email.toLowerCase() === email.toLowerCase())) {
                document.getElementById('regEmailErr').textContent = 'Email already registered';
                document.getElementById('regEmailErr').style.display = 'block';
                return;
            }
            
            // Register
            users.push({
                name,
                email,
                password: pass,
                securityQuestion: question,
                securityAnswer: answer.toLowerCase()
            });
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            localStorage.setItem('userLoggedIn', 'true');
            localStorage.setItem('userName', name);
            localStorage.setItem('userEmail', email);
            
            showNotif('Account created! Logging in...', 'success');
            setTimeout(() => window.location.href = 'dashboard.html', 1500);
        });
    </script>
</body>
</html>
